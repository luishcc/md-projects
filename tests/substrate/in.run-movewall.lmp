units lj
dimension 3
boundary p p p

processors 2 * 1

atom_style hybrid angle mdpd
neighbor 0.3 bin
neigh_modify every 1 delay 0 check yes
comm_modify vel yes cutoff 2.0

region        box  block -20 20 -50 50 0 30 units box
create_box    2    box

mass 1 1
mass 2 1

region        wall   block INF INF INF INF 1 3

create_atoms  1 random $(round(6.9*lx*ly*2.1)) 2021 wall
group wall type 1


###########################################################
# Pair, Bond and Angle Coefficients

pair_style hybrid/overlay mdpd/rhosum mdpd 1.0 1.0 65689
pair_coeff  *  *   mdpd/rhosum  0.75

pair_coeff  1  1   mdpd  -70.0  25.0  4.5  1.0  0.75
pair_coeff  2  2   mdpd  -50.0  25.0  4.5  1.0  0.75

pair_coeff  1  2   mdpd  -25.0  25.0  4.5  1.0  0.75

###########################################################

compute             mythermo all temp
thermo              100
thermo_modify       temp mythermo
thermo_modify       flush yes

dump 1 all atom 100 movewall.lammpstrj

min_style cg
minimize 1e-4 1e-4 1000 10000

fix 20 all balance 100 1.05 shift y 10 1.05


fix         mvv     all mvv/dpd 0.65
timestep 0.01
run 2000

variable R equal 12
region        drop   sphere 0 0 $(v_R+3) v_R 

create_atoms  2 random $(round(6.9*3.1415*v_R^3*4/3)) 2021 drop
group drop type 2


velocity wall set 0 0 0
fix 1 wall setforce 0 0 0

#neigh_modify exclude type 1 1

min_style cg
minimize 1e-4 1e-4 1000 10000

timestep 0.01
run 10000

# reset_timestep 0 time 0  # So that force starts to be applied when t=0


# From the solution to x'' + x = 0, with bc x(0)=0 and x'(0)=A*w
# x(t) = A*sin(w*t)
# x'(t) = v(t) = A*w*cos(w*t)
# x''(t) = a(t) = F(t)/m = -A*w^2*sin(w*t)
# Setting an initial velocity is necessary to keep droplet in place


variable ampMax equal 10
variable freq equal 0.02
variable period equal 1/v_freq
variable amp equal v_ampMax/(4*v_period)*time
variable omega equal 2*PI*v_freq
variable oscillation equal -v_amp*v_omega^2*sin(v_omega*(time))
variable velocity equal v_amp*v_omega*cos(v_omega*(time))

fix f1 wall move wiggle 0 200 0 60

# fix f1 wall setforce 0 v_oscillation 0

run 10000

